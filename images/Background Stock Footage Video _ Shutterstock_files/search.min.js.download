!function(a){a.fn.pathchange=function(a){return a?this.bind("pathchange",a):this.trigger("pathchange")};var b=a.pathchange={options:{useHistory:!0,useHashchange:!0,pollingInterval:250,interceptLinks:!0,disableHashLinks:!0},init:function(c){var d;a.extend(b.options,c),b.options.useHistory&&b.detectHistorySupport()&&a(window).bind("popstate",function(){a(window).trigger("pathchange")}),b.options.useHashchange&&(a(window).bind("hashchange",function(){a(window).trigger("pathchange")}),b.detectHashchangeSupport()||(d=window.location.hash,setInterval(function(){d!==window.location.hash&&(a(window).trigger("hashchange"),d=window.location.hash)},b.options.pollingInterval))),b.options.interceptLinks&&a("body").delegate("a[href^='/']","click",function(c){b.changeTo(a(this).attr("href")),c.preventDefault()}),b.options.disableHashLinks&&a("body").delegate("a[href='#']","click",function(a){a.preventDefault()})},changeTo:function(c){b.options.useHistory&&b.detectHistorySupport()?(window.history.pushState(null,null,c),a(window).trigger("pathchange")):(c.indexOf("#")<0&&(c+="#"),window.location.href=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+c)},detectHistorySupport:function(){return!(!window.history||!history.pushState)},detectHashchangeSupport:function(){var a="onhashchange"in window;return!a&&window.setAttribute&&(window.setAttribute("onhashchange","return;"),a="function"==typeof window.onhashchange),a}}}(jQuery);var Ss=window.Ss||{};!function(a,b){function c(c,g){this.$el=a(c),this.settings=a.extend({},d,g),b.LocalStore&&!e.get&&(e=new b.LocalStore({name:this.settings.localStoreKey}),f=!!e.get),this.sequenceNum=0,this.highlightRegex=null,this.init()}var d={endpoint:"/display_names.js",localStoreKey:"contributorStore",appendDropdownToSel:"#set-contributor"},e={},f=!1;c.prototype={init:function(){var b=this,c=b.$el.autocomplete({minLength:2,source:function(c,d){var g=b.$el.val().slice(0,2).toLowerCase(),h=f&&e.get(g);h?d(b.parseItems(h)):(b.sequenceNum++,a.ajax({url:b.settings.endpoint,data:{prefix:g,sequence_number:b.sequenceNum},success:function(c){var h=a.parseJSON(c.split("=")[2].replace(";",""));f&&e.store(g,h),d(b.parseItems(h))}}))},appendTo:b.settings.appendDropdownToSel,autoFocus:!0,select:function(a,c){b.$el.val(c.item.value),b.$el.closest("form").submit()}});c.length>0&&(c.data("autocomplete")._renderItem=b.renderItem)},parseItems:function(b){var c=this.$el.val().toLowerCase(),d=b.filter(function(a){return a.n.toLowerCase().indexOf(c)>-1});return this.highlightRegex=new RegExp(c,"gi"),a.map(d,function(a){return{label:a.n,value:a.n}})},renderItem:function(b,c){return a("<li></li>").data("item.autocomplete",c).append("<a>"+c.label.replace(this.highlightRegex,function(a){return"<b>"+a+"</b>"})+"</a>").appendTo(b)}},b.contributorAutocomplete=function(b,d){return a(b).each(function(){new c(this,d)})}}(jQuery,Ss),Ss=window.Ss||{},function(a,b,c,d){function e(a,b){this.options=c.extend(!0,{},f,b),c.extend(this,this.options.keyHandlers),this.activeItem=void 0,this.navigation=this.options.navigation,this.el=a,this.$el=c(this.el),this.initNavigation(),this.$el.on("keydown",this.onKeyDown.bind(this))}var f={debug:!1,el:"body",$el:null,navigation:{el:"",$el:null,itemSelectedCallback:function(){},cleanCallback:function(){}},keyboardModeActivated:!1,preKeyDownCallback:function(){},postKeyDownCallback:function(){},keyHandlers:{}},g={13:"Enter",27:"Escape",32:"Space",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",65:"KeyA",67:"KeyC",68:"KeyD",83:"KeyS"},h=Object.keys(g).map(function(a){return g[a]}),i={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT"};e.prototype.initNavigation=function(a){a&&(this.navigation.sel=a),this.navigation.sel&&(this.navigation.$el=c(this.navigation.sel))},e.prototype.onKeyDown=function(a){var b=a.target||a.srcElement;if("INPUT"==b.nodeName)return void 0;this.options.preKeyDownCallback.call(this,a);var c;c=h.indexOf(a.key)>-1?a.key:g[a.keyCode]||g[a.which],c&&"function"==typeof this["keyHandler"+c]&&(this.logger("KeyDown: ",c,a.keyCode),this["keyHandler"+c].call(this,a),this.logger("ActiveItem: ",this.activeItem),a.stopPropagation(),a.preventDefault()),this.options.postKeyDownCallback.call(this,a)},e.prototype.scrollPage=function(){this.logger("scrollPage");var a=this.activeItem[0].getBoundingClientRect();this.logger("clientRect.top",a.top),a.top<0&&window.scrollBy(0,a.top-10),this.logger("clientRect.bottom",a.bottom,window.innerHeight),a.bottom>window.innerHeight&&window.scrollBy(0,a.bottom-window.innerHeight+10)},e.prototype.changeActiveItem=function(a,b,c){this.deselectActiveItem(),this.activeItem=b,this.selectActiveItem(),this.scrollPage(c),this.navigation.itemSelectedCallback.call(this,a,this.activeItem)},e.prototype.deselectActiveItem=function(){this.activeItem&&this.activeItem.removeClass("keyboard-active")},e.prototype.selectActiveItem=function(){this.activeItem&&this.activeItem.addClass("keyboard-active")},e.prototype.getNextItem=function(){if(!this.activeItem)return this.setActiveItem(),this.activeItem;var a=this.activeItem.index();return a<this.navigation.$el.length-1&&a++,this.navigation.$el.eq(a)},e.prototype.getPreviousItem=function(){if(!this.activeItem)return this.setActiveItem(),this.activeItem;var a=this.activeItem.index();return a>0&&a--,this.navigation.$el.eq(a)},e.prototype.setActiveItem=function(a){this.activeItem=a?a:this.navigation.$el.eq(0)},e.prototype.getProximityItem=function(a){if(!this.activeItem)return this.setActiveItem(),this.activeItem;for(var b=this.activeItem.index(),c=this.getCenterPoint(this.activeItem[0]),d=void 0,e=void 0,f=void 0,g=b;g>=0&&g<=this.navigation.$el.length-1;){var h,j;if(a===i.DOWN?g++:a===i.UP&&g--,0>g||g>this.navigation.$el.length-1)return d||h||this.activeItem;if(h=this.navigation.$el.eq(g),j=this.getCenterPoint(h[0]),void 0!==e){if(!(this.getCenterPointDifference(c,j).x<this.getCenterPointDifference(c,f).x))return d;d=h,e=g,f=j}else(j.y>c.y+0||j.y<c.y-0)&&(d=h,e=g,f=j)}return this.activeItem},e.prototype.getCenterPoint=function(a){var b=a.getBoundingClientRect();return{x:Math.floor(b.left+b.width/2),y:Math.floor(b.top+b.height/2)}},e.prototype.getCenterPointDifference=function(a,b){return{x:Math.abs(a.x-b.x),y:Math.abs(a.y-b.y)}},e.prototype.logger=function(){this.options.debug&&window.console&&window.console.debug.apply(console,arguments)},e.prototype.clean=function(a){this.deselectActiveItem(),this.activeItem=null,this.navigation.cleanCallback.call(this,a)},e.prototype.destroy=function(a){this.clean(a),this.navigation.$el=null},e.prototype.keyHandlerEnter=function(){this.activeItem&&this.activeItem.find("a.clip")[0].click()},e.prototype.keyHandlerEscape=function(){},e.prototype.keyHandlerSpace=function(){},e.prototype.keyHandlerArrowLeft=function(a){var b=this.getPreviousItem();this.changeActiveItem(a,b,i.LEFT)},e.prototype.keyHandlerArrowUp=function(a){var b=this.getProximityItem(i.UP);this.changeActiveItem(a,b,i.UP)},e.prototype.keyHandlerArrowRight=function(a){var b=this.getNextItem();this.changeActiveItem(a,b,i.RIGHT)},e.prototype.keyHandlerArrowDown=function(a){var b=this.getProximityItem(i.DOWN);this.changeActiveItem(a,b,i.DOWN)},e.prototype.keyHandlerKeyA=function(){},e.prototype.keyHandlerKeyC=function(){},e.prototype.keyHandlerKeyD=function(){},e.prototype.keyHandlerKeyS=function(){},d.KeyboardNavigation=e}(window,document,jQuery,Ss),function(a,b,c,d){function e(){var a=c(".search-paging-buttons").first().find("a:last-child").attr("href");a&&"#"!==a&&c.get(h(f(a)),function(){},"html")}function f(a){var b=/\&lang=[a-z]{2}/i,d="&lang="+c("html").attr("lang");return a.match(b)?a.replace(b,d):a+(-1!==a.indexOf("?")?d:"?"+d.substr(1))}function g(a){c.pathchange.changeTo(f(a))}function h(a){return a+(-1===a.indexOf("?")?"?":"&")+"ajax=1"}function i(a){c("#search-results").css("opacity",a?.5:1).find(".spinner").toggleClass("is-spinning"),p=a}function j(){var b=n.offset();a.pageYOffset>b.top-20&&a.scrollTo(0,b.top-20),r.hide(),a.tooltip&&tooltip.functions.destroy(tooltip),d.contributorAutocomplete("#contributor-input"),m(),t.destroy(),t.initNavigation(),o=setTimeout(e,2e3)}function k(){var b=0===a.location.hash.indexOf("#/video/search")?a.location.hash.substr(1):a.location.href;return b===q?void(q=!1):(q=!1,i(!0),clearTimeout(o),void c.get(h(b),function(a){n.html(a),i(!1),j()},"html"))}function l(a){if(a.hasClass("show-pending")){a.removeClass("show-pending").addClass("shown"),a.find(".hidden-hover, .related-preview").show();var b=c(".related-search-link").index(a.find(".related-search-link"))+1;d.track.event(["related search","hover","term",b])}}function m(){c(".icon-info").on("click",function(a){a.stopPropagation()}).tooltip({html:!0,trigger:"click",clickAway:!0})}var n=c("#search-delegate"),o=null,p=(n.is(".page-search-orig"),!1),q=a.location.href;0===a.location.hash.indexOf("#/video/search/")&&k(),c.pathchange.init({interceptLinks:!1}),c(a).on("pathchange",k);var r=d.videoPreviewOverlay(".clip-container",{disableBreakpoint:767,fullScreenBreakpoint:0});d.addToCart(".add-to-cart",{onShow:function(){d.track.lilBro({event_type:"event_compare",source:"s",uid:"src="+c("#search-results").data("tid"),user_agent:navigator.userAgent})}}),d.addToClipbox(".add-to-box",{isSignedIn:d.isLoggedIn,offset:{top:function(a){return a.is(".secondary-link")?-1:2},left:function(a){return a.is(".secondary-link")?-8:17}},onShow:function(){var a=this;if(!d.isLoggedIn&&a.$targetClip.hasClass("inlineclip-content")){var b=document.location,e=b.pathname+b.search+"&add_to_clipbox=1"+b.hash;a.$overlay.find("a").attr("href","/video/login?new=true&r="+encodeURIComponent(e))}var f=(a.clipData,c("#search-pager"));d.track.lilBro({event_type:"search_lightbox",query:c("#result-header").find(".query").text(),clip_id:a.clipData.clipId,clip_pos:a.clipData.position,clip_page:c("form.set-page").find("input").val(),results_per_page:f.find(".checked a").data("count"),results_total:f.data("total")},!0)}}),n.on("submit",".set-page",function(){if(!p){var a=c(this).attr("action"),b=c(this).find("input").val(),e=a+"&page="+(b.length>0?b:"1"),f=c(this).parents("#search-controls-bottom").length>0;g(e),d.track.event(["search paging"+(f?"bottom":""),"set","page",parseInt(b,10)]),d.track.lilBro({event_type:"search_pagination",tracking_id:c("#search-results").data("tid"),clip_page:b})}return!1}),n.on("blur",".set-page input",function(){var b="&page="+c(this).val(),d=this;return setTimeout(function(){var e=a.location.href;e.indexOf(b)<0&&c(d).parents(".set-page").submit()},200),!1}),o=setTimeout(e,2e3),n.on("click",".update-results",function(a){if(a.preventDefault(),!p){var b=c(this).attr("href");d.track.lilBro({event_type:"click"}),g(b)}}),n.on("submit","#set-category",function(){if(!p){var a=c(this).attr("action"),b=c(this).find("option:selected").val(),e=a+"&cat="+(b.length>0?b:"");g(e),d.track.event(["search facets","set","category",b.length>0?parseInt(b,10):0])}return!1}),n.on("change","#set-category select",function(){c("#set-category").submit()}),n.on("submit","#set-contributor",function(){if(!p){var a=c(this).attr("action"),b=c(this).find("input[type=text]").val(),e=a+"&contributor="+(b.length>0?b:"");g(e),d.track.event(["search facets","set","contributor"])}return!1}),d.contributorAutocomplete("#contributor-input");var s=_.debounce(l,333);n.on("mouseenter touchstart","#related-searches .search-related-term",function(a){if("touchstart"!==a.type){var b=c(this);b.addClass("show-pending"),s(b)}}),n.on("mouseleave","#related-searches .search-related-term",function(){var a=c(this);a.hasClass("shown")?(a.find(".hidden-hover, .related-preview").hide(),a.removeClass("shown control")):a.removeClass("show-pending")}),n.on("click","#back-to-top",function(){a.scrollTo(0,0)}),m();var t=new d.KeyboardNavigation("body",{navigation:{sel:".clip-item",itemSelectedCallback:function(a,b){b.data("clipId")?r.show(b[0]):r.hide()},cleanCallback:function(){r.hide()}},preKeyDownCallback:function(){r.removePageLevelEvents()},postKeyDownCallback:function(){setTimeout(function(){r.bindPageLevelEvents()},200)},keyHandlers:{keyHandlerEnter:function(){this.activeItem&&this.activeItem.find("a.clip")[0].click()},keyHandlerKeyC:function(){this.activeItem&&this.activeItem.find("a.add-to-cart")[0].click()}}});c(document.body).on("click",t.clean.bind(t))}(window,document,jQuery,Ss);